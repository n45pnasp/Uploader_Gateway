<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Uploader Gateway</title>
  <style>
    body { font-family: sans-serif; padding: 2em; background: #f9f9f9; }
    #status { background: #fff; padding: 1em; border: 1px solid #ccc; margin-top: 1em; }
  </style>
</head>
<body>
  <h2>Upload Gambar ke Google Drive</h2>

  <form id="uploadForm">
    <input type="file" id="fileInput" accept="image/*" required><br><br>
    <input type="submit" value="Upload Sekarang">
  </form>

  <div id="status">Belum ada upload.</div>

  <script>
    document.getElementById("uploadForm").addEventListener("submit", async function(event) {
      event.preventDefault();

      const file = document.getElementById("fileInput").files[0];
      if (!file) {
        document.getElementById("status").innerText = "Pilih file terlebih dahulu.";
        return;
      }

      document.getElementById("status").innerText = "Mengupload...";

      const reader = new FileReader();
      reader.onload = async function() {
        const base64 = reader.result.split(",")[1];

        const formData = new URLSearchParams();
        formData.append("action", "upload");
        formData.append("FILE", base64);
        formData.append("NAMA_FILE", file.name);
        formData.append("MIMETYPE", file.type);
        formData.append("FOLDER_ID", "1OlzYCscdRd4t-9jxMutbsjyZQeHOwiTL"); // ganti di sini!

        try {
          const response = await fetch("https://script.google.com/macros/s/AKfycbxHcWl7tGF8_zjMbv2BXALHicBoGWjN4W_i8zw70q9ZYXpLBohzzcKexC_HwDpCG2-4DA/exec", { // ganti di sini juga
            method: "POST",
            headers: {
              "Content-Type": "application/x-www-form-urlencoded"
            },
            body: formData
          });

          const text = await response.text();
          document.getElementById("status").innerText = "Upload selesai! File ID:\n" + text;

          // Kirim ke Kodular (WebViewer)
          if (window.AppInventor) {
            window.AppInventor.setWebViewString("UPLOAD_SUCCESS:" + text);
          }

        } catch (error) {
          document.getElementById("status").innerText = "Upload gagal: " + error;
          if (window.AppInventor) {
            window.AppInventor.setWebViewString("UPLOAD_FAILED");
          }
        }
      };

      reader.readAsDataURL(file);
    });
  </script>
</body>
</html>
